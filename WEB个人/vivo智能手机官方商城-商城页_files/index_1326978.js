$(function(){function t(t){this.option=$.extend({position:0,interval:6e3},t),this.init()}function e(t,e,i){var o=new Image;o.onload=e,o.onerror=i,o.src=t}var i=$(document);VIVO_UI.HighLightNav(0),$.extend(t.prototype,{init:function(){var t=this,e=this.option.$thumbs.parent().parent()[0];this.time=0,this.option.$thumbs.on("click",function(){var e;t.locked||(e=$(this).index(),t.option.position!==e&&t.goto(e))}),e.onmouseenter=function(){t.stop()},e.onmouseleave=function(){t.start()}},"goto":function(t){var e,i,o=this;this.locked||(this.locked=!0,this.time=0,e=this.option.$items.eq(t),i=this.option.$items.eq(this.option.position),this.option.$thumbs.removeClass("current").eq(t).addClass("current").end().eq(this.option.position).find(".progress").css("width",0),this.option.position=t,e.addClass("show").css({opacity:0}).animate({opacity:1},1e3,function(){i.removeClass("current"),e.removeClass("show").addClass("current"),o.locked=!1}))},start:function(){var t=this;this.intervalId=setInterval(function(){t.time+=window.isIE8?100:50,t.time>t.option.interval&&(t.time=t.option.interval),t.option.$thumbs.eq(t.option.position).find(".progress").css("width",100*t.time/t.option.interval+"%"),t.time===t.option.interval&&t.goto((t.option.position+1)%t.option.$thumbs.length)},window.isIE8?100:50)},stop:function(){clearInterval(this.intervalId)}}),function(){var i=$(".banner .img-list").children(),o=$(".banner .thumb-list").children(),n=i.filter(".current")[0];i.each(function(){var a=$(this),r=a.find("img");e(r.attr("src"),function(){a.removeClass("loading"),r.css("visibility","visible"),i.length>1&&a[0]===n&&new t({$items:i,$thumbs:o}).start()},function(){a.removeClass("loading").addClass("error"),i.length>1&&a[0]===n&&new t({$items:i,$thumbs:o}).start()})})}(),function(){$(".floor-list").on("click",".color-list li",function(){var t,i,o,n,a,r=$(this);r.hasClass("selected")||(t=r.parent(),i=r.attr("data-img"),o=r.attr("data-href"),r.addClass("selected").siblings().removeClass("selected"),a=t.parent().prev().attr("href",o).children().eq(1),t.next().find(".prompt").text("已选："+t.attr("data-name")+" "+r.attr("title")),n=t.next().next().children().eq(0).attr("href",o).next(),n.attr("class","btn").removeAttr("href").addClass(["sellout","putin-shopcart","full-book"][r.attr("data-saleable")]),"2"===r.attr("data-saleable")&&n.attr("href",o),"load"===r.data("complete")?a.clone().attr("src",i).css({marginTop:-a.height(),opacity:0,visibility:"visible"}).appendTo(a.parent()).animate({opacity:1},function(){r[0]===r.parent().children(".selected")[0]&&(a.attr("src",i).css("visibility","visible").prev().addClass("hide"),a.nextAll().remove())}):"error"===r.data("complete")?a.prev().clone().addClass("error").removeClass("hide").css({position:"relative",display:"inline-block",marginTop:-a.height(),opacity:0}).appendTo(a.parent()).animate({opacity:1},function(){r[0]===r.parent().children(".selected")[0]&&(a.css("visibility","hidden").prev().addClass("error").removeClass("hide"),a.nextAll().remove())}):a.prev().clone().removeClass("error hide").css({position:"relative",display:"inline-block",marginTop:-a.height(),opacity:0}).appendTo(a.parent()).animate({opacity:1},function(){e(i,function(){r.data("complete","load"),r[0]===r.parent().children(".selected")[0]&&(a.attr("src",i).css("visibility","visible").prev().addClass("hide"),a.nextAll().remove())},function(){r.data("complete","error"),r[0]===r.parent().children(".selected")[0]&&(a.css("visibility","hidden").prev().addClass("error").removeClass("hide"),a.nextAll().remove())})}))})}(),function(){$(".fp .box > a > img, .p_3 .box > a > img, .pc_6 .box:first-child > a > img").each(function(){var t=$(this);e(t.attr("src"),function(){t.css({visibility:"visible"}).prev().addClass("hide")},function(){t.prev().addClass("error")})}),$(".color-list li:first-child").trigger("click")}(),window.onload=function(){$(".color-list li").each(function(){var t=$(this);e(t.attr("data-img"),function(){t.data("complete","load")},function(){t.data("complete","error")})})},function(){function t(t){var e=t[0].getBoundingClientRect(),o=a[0].getBoundingClientRect(),r=t.clone().css("visibility","visible").appendTo(document.body);r.css({position:"fixed",zIndex:"9999",left:e.left,top:e.top,width:e.right-e.left,height:e.bottom-e.top}).animate({width:50,height:50,left:(e.left+e.right)/2-25,top:(e.top+e.bottom)/2-25},function(){$(this).dequeue("verticalMove")}).animate({left:o.left},600,"linear").animate({top:o.top},{queue:"verticalMove",duration:600,easing:"easeInQuint",complete:function(){r.remove(),2===++n&&(i.trigger("updateShopcartNum"),a.trigger("click",[!0]))}})}var e,o,n,a=$("#side-bar .shopcart");$(".floor-list").on("click",".putin-shopcart",function(){var r,s=e;void 0!==o&&clearTimeout(o),e=(new Date).getTime(),o=setTimeout(function(){e=void 0},500),void 0===s&&(n=0,r=$(this).parent(),$.ajax({type:"post",url:"/shoppingcart/cartAdd",data:{skuId:r.siblings(".color-list").find(".selected").attr("data-skuid"),num:1,needCheck:1},dataType:"json",success:function(t,e){"success"===e&&200===t.retCode&&2===++n&&(i.trigger("updateShopcartNum"),a.trigger("click",[!0]))}}),t(r.parent().prev().children().last()))})}()}),$.fn.isOnScreen=function(){var t=$(window),e={top:t.scrollTop(),left:t.scrollLeft()};e.right=e.left+t.width(),e.bottom=e.top+t.height();var i=this.offset();return i.right=i.left+this.outerWidth(),i.bottom=i.top+this.outerHeight(),!(e.right<i.left||e.left>i.right||e.bottom<i.top||e.top>i.bottom)},$(function(){"undefined"!=typeof ISHOMEHEAD&&ISHOMEHEAD||$(".nav-gb").eq(0).find("a").addClass("current");var t=Array.apply(null,Array($(".box").length)).map(function(){return 1});$(window).on("scroll",function(){$(".box").each(function(e){$(this).isOnScreen()||(t[e]=1),$(this).isOnScreen()&&t[e]&&(console.log($(this).find("a").attr("data-name")),t[e]=0)})}).trigger("scroll"),Vtrack(function(){this.clickStats({cfrom:5100,pageview:"商城首页",is_done:1}),$(window).on("beforeunload",function(){Vtrack.clickStats({cfrom:5100,pageview:"商城首页",lefttime:+new Date})})},function(){console.warn("失败")}),$("a.logo").on("click",function(){Vtrack.clickStats({cfrom:5111,pageview:"商城首页",name:"商城logo"})}),$("a.help").on("click",function(){Vtrack.clickStats({cfrom:5109,pageview:"商城首页",name:"帮助中心"})}),$(".shopcart-fixbox").on("click",".clearing",function(){Vtrack.clickStats({cfrom:5110,pageview:"商城首页",name:"购物车立即结算"})}),$(".promise a").on("click",function(){var t=$(this).index()+1;Vtrack.clickStats({cfrom:5112,pageview:"商城首页",position:t,name:"信任图标"})}),$(".vvs-agree-item a").on("click",function(){var t=$(this).parent().index()+1;Vtrack.clickStats({cfrom:5112,pageview:"商城首页",position:t,name:"信任图标"})}),$(".img-list li").on("click",function(){var t=$(this).index()+1,e=$.trim($(this).attr("data-name"));Vtrack.clickStats({cfrom:5113,pageview:"商城首页",position:t,name:e})}),$("#side-bar").on("mouseup","li",function(){var t=$(this).attr("class"),e=3;switch(t){case"shopcart":e=1;break;case"service":e=2;break;case"feedback":e=4;break;case"backtop":e=5}Vtrack.clickStats({cfrom:5121,pageview:"商城首页",name:"浮动图标",position:e})}),$(".more-wrapper").on("click","a",function(){var t=$(this).parent(),e=t.parent().children().length,i=t.index(),o=$.trim(t.text()),n=$.trim(t.closest(".info").find(".subject").text()),a=e-i;Vtrack.clickStats({cfrom:"5120",pageview:"商城首页",name:o,position:a,source:n})}),$(".fp").on("click","a",function(){var t="",e="";this.href.replace(/\/(phone|parts|vcoins|brokenScreen)/i,function(i){switch(i.replace(/\W/i,"")){case"phone":t="5114",e="手机选购";break;case"parts":t="5115",e="配件选购";break;case"brokenScreen":t="5116",e="碎屏保选购";break;case"vcoins":t="5117",e="兑换V币商品"}}),Vtrack.clickStats({pageview:"商城首页",cfrom:t,name:e})}),$(".floor").not(".fp").on("click",'.box a:not(".sellout")',function(){var t=$(this),e=$.trim(t.closest(".floor").find(".subject").text()),i=t.closest(".box").children().eq(0).attr("data-name"),o=t.closest(".box").index()+1,n="5118";if(t.hasClass("putin-shopcart")){n="5119";var a=t.data().spustr.match(/product\/(\w+)[\?]?/i),r=a?a[1]:""}else var a=this.href.match(/product\/(\w+)[\?]?/i),r=a?a[1]:"";Vtrack.clickStats({pageview:"商城首页",cfrom:n,goodid:r,position:o,source:e,name:i})})});