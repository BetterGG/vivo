!function(){var n,t=!1,i=function(n,t){this.target=n,t&&(this.activityId=t),this.init()};$.extend(i.prototype,{init:function(){this._render()},_render:function(){var n=webCtx+"/campaign/popup.tpl",i=this;t?i._handleEvent(!0):(t=!0,setTimeout(function(){$.get(n,null,function(n){$(document.body).append(n),i._handleEvent(!1)})},1200))},_handleEvent:function(t){var i=this;if($(i.target).on("click",function(){$("#appointmentMobile").val(""),n=i.activityId,$("#j_appointStep1").fadeIn().css("margin-top",-$("#j_appointStep1").height()/2),VIVO_UI.mask()}),!t){$("#j_appointStep1 .icon-close").on("click",function(){$("#j_appointStep1").fadeOut(),VIVO_UI.unmask()}),jQuery.validator.addMethod("isMobile",function(n,t){var i=n.length,e=/^(1[34578][0-9]{9})$/;return this.optional(t)||11==i&&e.test(n)},"请正确填写手机号码！");var e=$(".dialog-form").validate({debug:!0,errorElement:"span",errorClass:"error",focusInvalid:!1,rules:{appointmentMobile:{required:!0,isMobile:!0}},messages:{appointmentMobile:{required:"请输入手机号码！",isMobile:"请正确填写手机号码！"}}});$("#commit-btn").on("click",function(){if(!e.form())return void e.focusInvalid();$("#j_appointStep1").fadeOut(),VIVO_UI.unmask();var t={};t.appointmentMobile=$("input[name='appointmentMobile']").val(),t.activityId=n,$.ajax({url:webCtx+"/campaign/appointment/freeAppointment",data:t,type:"POST",success:function(n){new Dialog(200==n.retCode?{title:n.retMsg,icon:"success",confirmBtn:!0,confirmCallback:function(){$("input[name='appointmentMobile']").val("")}}:{title:"预约失败",content:"失败原因："+n.retMsg,icon:"warning",confirmBtn:!0,confirmCallback:function(){$("input[name='appointmentMobile']").val("")}})},error:function(){new Dialog({title:"预约失败",content:"请点击重试",icon:"warning",confirmBtn:!0,confirmText:"重新预约",cancelBtn:!1,confirmCallback:null})}})})}}}),$.fn.appointment=function(n){$(this).each(function(t,e){var o=n||$(e).attr("activity-id");o&&new i($(e),o)})},$(function(){$("[activity-id]").length&&$("[activity-id]").appointment()})}();